<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="/logo.png" /> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HoneyZest | Premium Honey</title> 
    
    <!-- 1. PRELOAD PARTICLES ENGINE -->
    <script src="https://cdn.jsdelivr.net/npm/tsparticles@2/tsparticles.bundle.min.js"></script>
    <script type="module" crossorigin src="/assets/index-DhJegbq9.js"></script>
    <link rel="stylesheet" crossorigin href="/assets/index-BV2zvQa6.css">
  </head>
  
  <body>
    <!-- 2. REACT APP ENTRY (CRITICAL) -->
    <div id="root" style="position: relative; z-index: 10;"></div>

    <!-- ================================================== -->
    <!-- HONEYZEST ULTIMATE ATMOSPHERE ENGINE (v4.0)        -->
    <!-- ================================================== -->

    <style>
      /* --- GLOBAL STYLES --- */
      body { margin: 0; overflow-x: hidden; }
      canvas { pointer-events: none !important; } /* Allows clicking through rain */

      /* --- GEAR ICON --- */
      #hz-gear-btn {
        position: fixed; top: 20px; right: 20px;
        width: 45px; height: 45px;
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(8px);
        border: 1px solid rgba(255,255,255,0.4);
        border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
        cursor: pointer; z-index: 99999;
        font-size: 22px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }
      #hz-gear-btn:hover { 
        transform: rotate(90deg) scale(1.1); background: #fff; color: #eab308; 
      }

      /* --- SETTINGS PANEL --- */
      #hz-settings-panel {
        position: fixed; top: 75px; right: 20px;
        width: 320px;
        background: #1e1e1e; /* Dark Modern Theme */
        color: #f5f5f5;
        border-radius: 16px;
        border: 1px solid #333;
        box-shadow: 0 30px 60px rgba(0,0,0,0.5);
        z-index: 99998;
        font-family: system-ui, -apple-system, sans-serif;
        transform: scale(0.95) translateY(-15px);
        opacity: 0; pointer-events: none;
        transition: all 0.25s ease-out;
        display: flex; flex-direction: column;
        max-height: 85vh;
      }
      #hz-settings-panel.active { opacity: 1; transform: scale(1) translateY(0); pointer-events: auto; }

      /* HEADER */
      .hz-header {
        padding: 15px 20px;
        background: linear-gradient(90deg, #ca8a04, #eab308);
        border-radius: 15px 15px 0 0;
        display: flex; justify-content: space-between; align-items: center;
      }
      .hz-header h3 { margin: 0; font-size: 13px; font-weight: 800; text-transform: uppercase; color: #fff; letter-spacing: 1px; }
      
      /* SCROLLABLE BODY */
      .hz-body { padding: 20px; overflow-y: auto; overflow-x: hidden; }

      /* SECTIONS */
      .hz-group { margin-bottom: 18px; }
      .hz-label { font-size: 10px; font-weight: 700; color: #a3a3a3; text-transform: uppercase; margin-bottom: 6px; display: block; letter-spacing: 0.5px; }

      /* INPUTS */
      .hz-select, .hz-range {
        width: 100%; background: #2d2d2d; color: #fff; border: 1px solid #444;
        padding: 8px 12px; border-radius: 8px; font-size: 12px; outline: none; cursor: pointer;
        transition: border 0.2s;
      }
      .hz-select:focus { border-color: #eab308; }
      .hz-select:disabled { opacity: 0.5; cursor: not-allowed; }

      /* TOGGLE ROWS */
      .hz-row {
        display: flex; justify-content: space-between; align-items: center;
        background: #262626; padding: 10px 12px; border-radius: 8px; margin-bottom: 10px; border: 1px solid #333;
      }
      .hz-row-title { font-size: 13px; font-weight: 600; }
      .hz-row-desc { font-size: 10px; color: #888; margin-top: 2px; }

      /* BUTTONS */
      .hz-btn-reset {
        width: 100%; padding: 10px; border: none; border-radius: 8px;
        background: #ef4444; color: white; font-weight: bold; cursor: pointer;
        font-size: 12px; margin-top: 10px; opacity: 0.8; transition: opacity 0.2s;
      }
      .hz-btn-reset:hover { opacity: 1; }

      /* --- VISUAL OVERLAYS --- */
      .hz-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 5; transition: opacity 1.5s ease; opacity: 0; }
      .hz-night { background: linear-gradient(to bottom, rgba(2,6,23,0.85), rgba(0,0,0,0.4)); }
      .hz-mist { background: rgba(220, 230, 255, 0.15); backdrop-filter: blur(3px); }
      .hz-flash { background: #fff; z-index: 9999; transition: opacity 0.05s; }
      .visible { opacity: 1 !important; }
    </style>

    <!-- 4. AUDIO ASSETS (Muted by default) -->
    <audio id="sfx-rain" loop src="https://assets.mixkit.co/active_storage/sfx/2497/2497-preview.mp3"></audio>
    <audio id="sfx-thunder" src="https://assets.mixkit.co/active_storage/sfx/1273/1273-preview.mp3"></audio>
    <audio id="sfx-wind" loop src="https://assets.mixkit.co/active_storage/sfx/1483/1483-preview.mp3"></audio>

    <!-- 5. UI ELEMENTS -->
    <div id="hz-layer-night" class="hz-overlay hz-night"></div>
    <div id="hz-layer-mist" class="hz-overlay hz-mist"></div>
    <div id="hz-layer-flash" class="hz-overlay hz-flash"></div>

    <div id="hz-gear-btn" onclick="toggleSettings(event)">âš™ï¸</div>

    <div id="hz-settings-panel">
      <div class="hz-header">
        <h3>Environment Settings</h3>
        <div style="cursor:pointer; font-size:18px;" onclick="closeSettings()">âœ•</div>
      </div>
      
      <div class="hz-body">
        
        <!-- AUTO MODE -->
        <div class="hz-row">
          <div>
            <div class="hz-row-title">âœ¨ Smart Auto-Pilot</div>
            <div class="hz-row-desc" id="hz-status-text">Detecting Location...</div>
          </div>
          <input type="checkbox" id="hz-auto-switch" checked onchange="toggleAuto(this.checked)" style="accent-color:#eab308; transform:scale(1.2); cursor:pointer;">
        </div>

        <!-- WEATHER -->
        <div class="hz-group">
          <label class="hz-label">Atmosphere Condition</label>
          <select id="hz-weather-select" class="hz-select" onchange="manualUpdate()" disabled>
            <option value="clear">â˜€ï¸ Sunny / Clear</option>
            <option value="rain">ğŸŒ§ï¸ Rain Shower</option>
            <option value="thunder">âš¡ Thunderstorm</option>
            <option value="snow">â„ï¸ Snowfall</option>
            <option value="wind">ğŸƒ Windy / Storm</option>
            <option value="mist">ğŸŒ«ï¸ Fog / Mist</option>
            <option value="confetti">ğŸ‰ Celebration</option>
            <option value="love">â¤ï¸ Hearts / Love</option>
          </select>
        </div>

        <!-- TIME OF DAY -->
        <div class="hz-group">
          <label class="hz-label">Time of Day (Lighting)</label>
          <select id="hz-time-select" class="hz-select" onchange="manualUpdate()" disabled>
            <option value="auto">ğŸ•’ Auto (Real Time)</option>
            <option value="day">â˜€ï¸ Always Day</option>
            <option value="night">ğŸŒ™ Always Night</option>
          </select>
        </div>

        <!-- INTENSITY -->
        <div class="hz-group">
          <label class="hz-label">Effect Intensity</label>
          <input type="range" id="hz-intensity" class="hz-range" min="10" max="200" value="80" oninput="manualUpdate()">
        </div>

        <!-- PERFORMANCE MODE -->
        <div class="hz-row">
          <div>
            <div class="hz-row-title">ğŸš€ Lite / Battery Saver</div>
            <div class="hz-row-desc">Reduces effects for speed</div>
          </div>
          <input type="checkbox" id="hz-lite-mode" onchange="manualUpdate()" style="accent-color:#22c55e; transform:scale(1.2); cursor:pointer;">
        </div>

        <!-- SOUND -->
        <div class="hz-row">
          <div>
            <div class="hz-row-title">ğŸ”Š Nature Sounds</div>
            <div class="hz-row-desc">Rain & Wind Ambience</div>
          </div>
          <input type="checkbox" id="hz-sound-switch" onchange="toggleSound(this.checked)" style="accent-color:#eab308; transform:scale(1.2); cursor:pointer;">
        </div>

        <!-- CURRENCY & LANG -->
        <div class="hz-group">
          <label class="hz-label">Region Preferences</label>
          <select id="hz-currency-select" class="hz-select" onchange="manualUpdate()" disabled style="margin-bottom:8px;">
            <option value="KES">ğŸ‡°ğŸ‡ª KES (Kenya)</option>
            <option value="USD">ğŸ‡ºğŸ‡¸ USD (Global)</option>
            <option value="EUR">ğŸ‡ªğŸ‡º EUR (Europe)</option>
            <option value="GBP">ğŸ‡¬ğŸ‡§ GBP (UK)</option>
            <option value="NGN">ğŸ‡³ğŸ‡¬ NGN (Nigeria)</option>
            <option value="ZAR">ğŸ‡¿ğŸ‡¦ ZAR (South Africa)</option>
            <option value="AED">ğŸ‡¦ğŸ‡ª AED (Dubai)</option>
            <option value="CNY">ğŸ‡¨ğŸ‡³ CNY (China)</option>
          </select>
          <select id="hz-lang-select" class="hz-select" onchange="manualUpdate()" disabled>
            <option value="en">English</option>
            <option value="sw">Swahili</option>
            <option value="fr">French</option>
            <option value="de">German</option>
            <option value="es">Spanish</option>
            <option value="ar">Arabic</option>
            <option value="zh">Chinese</option>
          </select>
        </div>

        <!-- RESET -->
        <button class="hz-btn-reset" onclick="factoryReset()">â†º Factory Reset / Re-Detect</button>
      </div>
    </div>

    <!-- 6. ENGINE SCRIPT -->
    <script>
      const API_KEY = "cbcace2f2fd0530b63a92e3cd2ed6fe0";
      // Elements that rain bounces off
      const BOUNCE_TARGETS = "button, .btn, input[type='submit'], .card, img, nav, .logo, a";

      let tsInstance;
      let thunderTimer;

      // === 1. CLICK OUTSIDE LOGIC ===
      document.addEventListener('click', function(event) {
        const panel = document.getElementById('hz-settings-panel');
        const btn = document.getElementById('hz-gear-btn');
        // If panel is open AND click is NOT on panel AND click is NOT on btn
        if (panel.classList.contains('active') && !panel.contains(event.target) && !btn.contains(event.target)) {
          closeSettings();
        }
      });

      function toggleSettings(e) {
        if(e) e.stopPropagation(); // Stop click from hitting document
        const panel = document.getElementById('hz-settings-panel');
        panel.classList.toggle('active');
      }

      function closeSettings() {
        document.getElementById('hz-settings-panel').classList.remove('active');
      }

      // === 2. UI CONTROLS ===
      function toggleAuto(isAuto) {
        const ids = ['hz-weather-select', 'hz-time-select', 'hz-currency-select', 'hz-lang-select'];
        ids.forEach(id => document.getElementById(id).disabled = isAuto);
        
        if (isAuto) {
          runAutoDetect();
        } else {
          document.getElementById('hz-status-text').innerText = "Manual Override Active";
          manualUpdate();
        }
      }

      function toggleSound(enabled) {
        if(!enabled) {
          document.querySelectorAll('audio').forEach(a => { a.pause(); a.currentTime = 0; });
        } else {
          manualUpdate(); // Restart sounds
        }
      }

      function factoryReset() {
        document.getElementById('hz-auto-switch').checked = true;
        document.getElementById('hz-lite-mode').checked = false;
        document.getElementById('hz-sound-switch').checked = false;
        document.getElementById('hz-intensity').value = 80;
        toggleAuto(true);
      }

      function manualUpdate() {
        const weather = document.getElementById('hz-weather-select').value;
        const timeMode = document.getElementById('hz-time-select').value;
        const intensity = document.getElementById('hz-intensity').value;
        const isLite = document.getElementById('hz-lite-mode').checked;
        
        // 1. Handle Night Mode
        const nightLayer = document.getElementById('hz-layer-night');
        if (timeMode === 'night') nightLayer.classList.add('visible');
        else if (timeMode === 'day') nightLayer.classList.remove('visible');
        // Note: 'auto' time is handled in runAutoDetect, or defaults to day in manual if unchecked

        // 2. Handle Currency/Lang
        const c = document.getElementById('hz-currency-select').value;
        const l = document.getElementById('hz-lang-select').value;
        localStorage.setItem('hz_currency', c);
        localStorage.setItem('hz_lang', l);

        // 3. Apply Visuals
        applyTheme(weather, intensity, isLite);
      }

      // === 3. PHYSICS ENGINE ===
      function getBaseConfig() {
        return {
          fullScreen: { enable: true, zIndex: 1 }, 
          fpsLimit: 60,
          background: { color: "transparent" }, // Fixes white screen
          particles: { move: { enable: true } },
          interactivity: {
            detectsOn: "window",
            events: { onDiv: { selectors: BOUNCE_TARGETS, enable: true, mode: "bounce", type: "rectangle" } }
          }
        };
      }

      async function applyTheme(type, intensity, isLite) {
        const config = getBaseConfig();
        const soundOn = document.getElementById('hz-sound-switch').checked;

        // Reduce particles if Lite Mode
        let count = parseInt(intensity);
        if (isLite) count = Math.floor(count / 2);

        // Reset
        clearInterval(thunderTimer);
        document.getElementById('hz-layer-mist').classList.remove('visible');
        ['sfx-rain', 'sfx-wind'].forEach(id => document.getElementById(id).pause());

        // THEMES
        if (type === 'rain' || type === 'thunder') {
          config.particles = {
            number: { value: count }, color: { value: "#a2d2ff" },
            shape: { type: "line" }, opacity: { value: 0.7 },
            size: { value: { min: 1, max: 3 } },
            move: { enable: true, speed: 20, direction: "bottom", gravity: { enable: true, acceleration: 15 }, straight: true }
          };
          if (soundOn) document.getElementById('sfx-rain').play();
          if (type === 'thunder') startThunder(soundOn);
        }
        else if (type === 'snow') {
          config.particles = {
            number: { value: count }, color: { value: "#fff" },
            shape: { type: "circle" }, opacity: { value: 0.9 },
            size: { value: { min: 2, max: 6 } },
            move: { enable: true, speed: 3, direction: "bottom", random: true }
          };
        }
        else if (type === 'wind') {
          config.particles = {
            number: { value: count / 2 }, color: { value: ["#5e3a07", "#2f4f2f", "#8b5a2b"] },
            shape: { type: "polygon", options: { polygon: { sides: 3 } } },
            move: { enable: true, speed: 35, direction: "right" }
          };
          if (soundOn) document.getElementById('sfx-wind').play();
        }
        else if (type === 'mist') {
          document.getElementById('hz-layer-mist').classList.add('visible');
          config.particles = { number: { value: 0 } };
        }
        else if (type === 'confetti') {
           config.particles = {
            number: { value: count }, color: { value: ["#f00", "#0f0", "#00f", "#ff0"] },
            shape: { type: ["circle", "square"] }, size: { value: 5 },
            move: { enable: true, speed: 10, direction: "bottom", outModes: "out" }
          };
        }
        else if (type === 'love') {
           config.particles = {
            number: { value: count / 2 }, color: { value: "#e11d48" },
            shape: { type: "heart" }, size: { value: 10 },
            move: { enable: true, speed: 2, direction: "top", random: true }
          };
        }
        else {
          // Clear
           config.particles = {
            number: { value: 15 }, color: { value: "#FFD700" },
            shape: { type: "circle" }, opacity: { value: 0.3 },
            move: { speed: 1, direction: "none", random: true }
          };
        }

        if (tsInstance) await tsInstance.load("tsparticles", config);
        else tsInstance = await tsParticles.load("tsparticles", config);
      }

      function startThunder(soundOn) {
        thunderTimer = setInterval(() => {
          if(Math.random() > 0.85) {
            const flash = document.getElementById('hz-layer-flash');
            flash.classList.add('visible');
            if(soundOn) document.getElementById('sfx-thunder').play();
            setTimeout(() => flash.classList.remove('visible'), 150);
          }
        }, 2000);
      }

      // === 4. AUTO DETECT ===
      function runAutoDetect() {
        if (!navigator.geolocation) return;
        
        navigator.geolocation.getCurrentPosition(async (pos) => {
          const { latitude: lat, longitude: lon } = pos.coords;
          try {
            const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric`);
            const data = await res.json();
            
            // Location Text
            document.getElementById('hz-status-text').innerText = `Live: ${data.name}, ${data.sys.country}`;

            // Map Country to Currency/Lang
            const code = data.sys.country;
            let c = 'USD'; let l = 'en';
            if(code === 'KE') { c = 'KES'; l = 'sw'; }
            else if(['GB','UK'].includes(code)) c = 'GBP';
            else if(['FR','DE','ES'].includes(code)) c = 'EUR';
            
            document.getElementById('hz-currency-select').value = c;
            document.getElementById('hz-lang-select').value = l;

            // Weather & Time
            const id = data.weather[0].id;
            const isNight = (data.dt > data.sys.sunset || data.dt < data.sys.sunrise);
            
            // Auto-Set Time Dropdown (visual only)
            document.getElementById('hz-time-select').value = 'auto';
            const nightLayer = document.getElementById('hz-layer-night');
            if(isNight) nightLayer.classList.add('visible');
            else nightLayer.classList.remove('visible');

            let theme = 'clear';
            if (id >= 200 && id <= 232) theme = 'thunder';
            else if (id >= 300 && id <= 531) theme = 'rain';
            else if (id >= 600 && id <= 622) theme = 'snow';
            else if (id >= 700 && id <= 781) theme = 'mist';
            else if (data.wind.speed > 10) theme = 'wind';
            
            document.getElementById('hz-weather-select').value = theme;
            applyTheme(theme, 80, false);

          } catch (e) { console.error(e); }
        });
      }

      // === 5. INIT ===
      window.onload = () => {
        setTimeout(() => {
          if(document.getElementById('hz-auto-switch').checked) runAutoDetect();
        }, 2000);
      };
    </script>
  </body>
</html>