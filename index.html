<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="/logo.png" /> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HoneyZest | Premium Honey</title> 
    
    <!-- 1. LOAD PARTICLES ENGINE -->
    <script src="https://cdn.jsdelivr.net/npm/tsparticles@2/tsparticles.bundle.min.js"></script>
    <script type="module" crossorigin src="/assets/index-DKIWevcV.js"></script>
    <link rel="stylesheet" crossorigin href="/assets/index-BUnpDFoU.css">
  </head>
  
  <body>
    <!-- ================================================== -->
    <!-- LAYER 1: YOUR WEBSITE (MUST BE Z-INDEX 10)         -->
    <!-- ================================================== -->
    <div id="root" style="position: relative; z-index: 10; background: transparent;"></div>

    <!-- ================================================== -->
    <!-- LAYER 2: HONEYZEST ATMOSPHERE ENGINE               -->
    <!-- ================================================== -->

    <style>
      /* FORCE PARTICLES TO BE TRANSPARENT & BEHIND CONTENT */
      #tsparticles {
        position: fixed; top: 0; left: 0;
        width: 100%; height: 100%;
        z-index: 1; /* Below the website content */
        pointer-events: none !important; /* Click through rain */
      }
      
      /* GEAR BUTTON */
      #hz-gear-btn {
        position: fixed; top: 20px; right: 20px;
        width: 50px; height: 50px;
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        border: 2px solid rgba(255,255,255,0.5);
        border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
        cursor: pointer; z-index: 99999; /* Always on top */
        font-size: 26px; 
        box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        transition: transform 0.4s ease;
      }
      #hz-gear-btn:hover { transform: rotate(90deg) scale(1.1); background: #fff; }

      /* SETTINGS PANEL */
      #hz-panel {
        position: fixed; top: 80px; right: 20px;
        width: 320px;
        background: rgba(15, 23, 42, 0.95); /* Dark Blue/Black */
        color: #fff;
        border-radius: 16px;
        box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        border: 1px solid rgba(255,255,255,0.1);
        z-index: 99998;
        font-family: sans-serif;
        transform: scale(0.95); opacity: 0; pointer-events: none;
        transition: all 0.3s ease;
        max-height: 80vh; overflow-y: auto;
      }
      #hz-panel.active { opacity: 1; transform: scale(1); pointer-events: auto; }

      /* UI ELEMENTS */
      .hz-header { padding: 15px; background: linear-gradient(90deg, #eab308, #ca8a04); border-radius: 16px 16px 0 0; display:flex; justify-content:space-between; align-items:center;}
      .hz-body { padding: 20px; }
      .hz-row { margin-bottom: 15px; }
      .hz-label { font-size: 11px; text-transform: uppercase; color: #94a3b8; font-weight: bold; display: block; margin-bottom: 5px; }
      
      select { width: 100%; padding: 10px; background: #334155; color: #fff; border: 1px solid #475569; border-radius: 8px; }
      
      /* NIGHT & MIST OVERLAYS */
      .hz-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 5; opacity: 0; transition: opacity 2s; }
      .hz-night { background: rgba(0, 0, 0, 0.6); } /* Darkens screen */
      .active { opacity: 1 !important; }
    </style>

    <!-- UI STRUCTURE -->
    <div id="hz-layer-night" class="hz-overlay hz-night"></div>
    
    <div id="hz-gear-btn" onclick="toggleSettings()">‚öôÔ∏è</div>

    <div id="hz-panel">
      <div class="hz-header">
        <strong style="color:white; font-size:14px;">HoneyZest Smart Settings</strong>
        <span style="cursor:pointer; font-size:18px;" onclick="toggleSettings()">√ó</span>
      </div>
      <div class="hz-body">
        
        <!-- AUTO TOGGLE -->
        <div class="hz-row" style="display:flex; justify-content:space-between;">
          <span style="font-size:13px;">‚ú® Live Auto-Detect</span>
          <input type="checkbox" id="hz-auto" checked onchange="toggleAuto(this.checked)">
        </div>
        <div id="hz-status" style="font-size:11px; color:#22d3ee; margin-bottom:15px;">Locating...</div>

        <!-- WEATHER -->
        <div class="hz-row">
          <label class="hz-label">Weather Effect</label>
          <select id="hz-weather" disabled onchange="manualUpdate()">
            <option value="clear">‚òÄÔ∏è Sunny / Clear</option>
            <option value="rain">üåßÔ∏è Rain</option>
            <option value="snow">‚ùÑÔ∏è Snow</option>
            <option value="wind">üçÉ Windy</option>
            <option value="confetti">üéâ Party Mode</option>
          </select>
        </div>

        <!-- CURRENCY -->
        <div class="hz-row">
          <label class="hz-label">Currency</label>
          <select id="hz-currency" disabled onchange="manualUpdate()">
            <option value="KES">üá∞üá™ KES (Kenya)</option>
            <option value="USD">üá∫üá∏ USD (Global)</option>
            <option value="EUR">üá™üá∫ EUR (Europe)</option>
            <option value="GBP">üá¨üáß GBP (UK)</option>
          </select>
        </div>
        
        <!-- LANGUAGE -->
        <div class="hz-row">
          <label class="hz-label">Language</label>
          <select id="hz-lang" disabled onchange="manualUpdate()">
            <option value="en">English</option>
            <option value="sw">Swahili</option>
            <option value="fr">French</option>
          </select>
        </div>

      </div>
    </div>

    <!-- ENGINE LOGIC -->
    <script>
      const API_KEY = "cbcace2f2fd0530b63a92e3cd2ed6fe0";
      // Selectors for bouncing
      const BOUNCE_TARGETS = "button, .btn, input[type='submit'], .card, img, nav";
      let tsInstance;

      function toggleSettings() { document.getElementById('hz-panel').classList.toggle('active'); }
      
      function toggleAuto(isAuto) {
        document.querySelectorAll('select').forEach(s => s.disabled = isAuto);
        if(isAuto) runAutoDetect();
        else document.getElementById('hz-status').innerText = "Manual Mode Active";
      }

      function manualUpdate() {
        const w = document.getElementById('hz-weather').value;
        loadTheme(w);
      }

      // --- PHYSICS CONFIG (FIXED VISIBILITY) ---
      function getConfig(type) {
        const config = {
          fullScreen: { enable: true, zIndex: 1 }, // Z-INDEX 1 puts it BEHIND your content (which is 10)
          background: { color: "transparent" }, // CRITICAL: Makes canvas invisible
          fpsLimit: 60,
          particles: { move: { enable: true } },
          interactivity: {
            detectsOn: "window",
            events: {
              onDiv: { selectors: BOUNCE_TARGETS, enable: true, mode: "bounce", type: "rectangle" }
            }
          }
        };

        if (type === 'rain') {
          config.particles = {
            number: { value: 100 }, color: { value: "#a2d2ff" }, shape: { type: "line" },
            opacity: { value: 0.7 }, size: { value: { min: 1, max: 3 } },
            move: { enable: true, speed: 20, direction: "bottom", gravity: { enable: true, acceleration: 15 }, straight: true }
          };
        } else if (type === 'snow') {
          config.particles = {
            number: { value: 50 }, color: { value: "#fff" }, shape: { type: "circle" },
            opacity: { value: 0.8 }, size: { value: { min: 2, max: 5 } },
            move: { enable: true, speed: 3, direction: "bottom", random: true }
          };
        } else if (type === 'wind') {
          config.particles = {
            number: { value: 30 }, color: { value: ["#5e3a07", "#2f4f2f"] },
            shape: { type: "polygon", options: { polygon: { sides: 3 } } },
            opacity: { value: 1 }, size: { value: { min: 3, max: 6 } },
            move: { enable: true, speed: 30, direction: "right" }
          };
        } else if (type === 'confetti') {
          config.particles = {
            number: { value: 50 }, color: { value: ["#ff0000", "#00ff00", "#0000ff"] },
            shape: { type: ["circle", "square"] }, size: { value: { min: 5, max: 10 } },
            move: { enable: true, speed: 10, direction: "bottom" }
          };
        } else {
           // Clear
           config.particles = { number: { value: 0 } };
        }
        return config;
      }

      async function loadTheme(theme) {
        const config = getConfig(theme);
        if (tsInstance) { await tsInstance.load("tsparticles", config); }
        else { tsInstance = await tsParticles.load("tsparticles", config); }
        
        // Night mode check
        if(theme === 'clear') document.getElementById('hz-layer-night').classList.remove('active');
      }

      // --- AUTO DETECT ---
      function runAutoDetect() {
        if(!navigator.geolocation) return;
        navigator.geolocation.getCurrentPosition(async (pos) => {
          const { latitude: lat, longitude: lon } = pos.coords;
          try {
            const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric`);
            const data = await res.json();
            
            document.getElementById('hz-status').innerText = `Live: ${data.name}`;
            
            // Map Country to Currency
            const code = data.sys.country;
            let curr = 'USD'; let lang = 'en';
            if(code === 'KE') { curr = 'KES'; lang = 'sw'; } // Kenya Specifics
            else if(['GB', 'UK'].includes(code)) curr = 'GBP';
            else if(['FR','DE','IT'].includes(code)) curr = 'EUR';
            
            document.getElementById('hz-currency').value = curr;
            document.getElementById('hz-lang').value = lang;

            // Map Weather
            const main = data.weather[0].main.toLowerCase();
            let w = 'clear';
            if(main.includes('rain')) w = 'rain';
            else if(main.includes('snow')) w = 'snow';
            else if(data.wind.speed > 10) w = 'wind';
            
            document.getElementById('hz-weather').value = w;
            loadTheme(w);

            // Night Check
            const isNight = (data.dt > data.sys.sunset || data.dt < data.sys.sunrise);
            if(isNight) document.getElementById('hz-layer-night').classList.add('active');
            else document.getElementById('hz-layer-night').classList.remove('active');

          } catch(e) {}
        });
      }

      // START
      window.onload = () => { setTimeout(runAutoDetect, 2000); };
    </script>
  </body>
</html>