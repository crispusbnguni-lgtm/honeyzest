<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="/logo.png" /> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HoneyZest | Premium Honey</title> 
    <script type="module" crossorigin src="/assets/index-DhJegbq9.js"></script>
    <link rel="stylesheet" crossorigin href="/assets/index-BV2zvQa6.css">
  </head>
  <body>
    <!-- Your React App Mounts Here -->
    <div id="root"></div>
    
    <!-- Your Main React Script -->

    <!-- ========================================== -->
    <!-- START: HONEYZEST SMART ATMOSPHERE SYSTEM   -->
    <!-- ========================================== -->

    <!-- 1. Load Particles Engine -->
    <script src="https://cdn.jsdelivr.net/npm/tsparticles@2/tsparticles.bundle.min.js"></script>

    <!-- 2. Advanced Styles (Glassmorphism & Animations) -->
    <style>
      /* SETTINGS BUTTON (Floating Gear) */
      #hz-settings-trigger {
        position: fixed; bottom: 25px; left: 25px;
        width: 50px; height: 50px;
        background: #fff; border-radius: 50%;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        display: flex; align-items: center; justify-content: center;
        cursor: pointer; z-index: 10001;
        font-size: 24px; transition: transform 0.3s ease;
        border: 2px solid #f0f0f0;
      }
      #hz-settings-trigger:hover { transform: rotate(90deg) scale(1.1); }

      /* MAIN PANEL */
      #hz-control-panel {
        position: fixed; bottom: 85px; left: 25px;
        width: 280px;
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-radius: 16px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        padding: 20px;
        z-index: 10000;
        font-family: 'Segoe UI', sans-serif;
        border: 1px solid rgba(255,255,255,0.5);
        display: none; /* Hidden by default */
        opacity: 0; transform: translateY(10px);
        transition: all 0.3s ease;
      }
      #hz-control-panel.open { display: block; opacity: 1; transform: translateY(0); }

      /* HEADERS & SECTIONS */
      .hz-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
      .hz-header h4 { margin: 0; font-size: 16px; font-weight: 700; color: #1e293b; }
      .hz-close { cursor: pointer; color: #999; font-size: 20px; }
      
      .hz-section { margin-bottom: 15px; }
      .hz-label { font-size: 12px; font-weight: 600; color: #64748b; margin-bottom: 5px; display: block; text-transform: uppercase; letter-spacing: 0.5px; }
      
      /* FORM ELEMENTS */
      .hz-select {
        width: 100%; padding: 8px 10px; border-radius: 8px;
        border: 1px solid #cbd5e1; background: #f8fafc;
        font-size: 14px; color: #334155; cursor: pointer; outline: none;
      }
      .hz-select:focus { border-color: #3b82f6; background: #fff; }

      /* AUTO SWITCH */
      .hz-auto-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #eee; }
      .hz-switch-label { font-size: 14px; font-weight: 600; color: #333; }
      
      /* STATUS BAR */
      #hz-status-bar {
        margin-top: 10px; padding-top: 10px; border-top: 1px solid #eee;
        font-size: 11px; color: #64748b; display: flex; align-items: center; gap: 5px;
      }
      .hz-status-dot { width: 8px; height: 8px; background: #22c55e; border-radius: 50%; display: inline-block; }

      /* ATMOSPHERE LAYERS */
      .hz-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 9998; transition: opacity 2s; opacity: 0; }
      
      /* Night Mode */
      .hz-night { background: linear-gradient(to bottom, rgba(2,6,23,0.7), rgba(15,23,42,0.3)); }
      /* Thunder Flash */
      .hz-flash { background: rgba(255,255,255,0.3); z-index: 9999; opacity: 0; transition: opacity 0.1s; }
      /* Mist/Fog */
      .hz-mist { background: rgba(255,255,255,0.4); backdrop-filter: blur(2px); }

      .active { opacity: 1 !important; }
    </style>

    <!-- 3. HTML Structure -->
    <div id="hz-layer-night" class="hz-overlay hz-night"></div>
    <div id="hz-layer-mist" class="hz-overlay hz-mist"></div>
    <div id="hz-layer-flash" class="hz-overlay hz-flash"></div>

    <!-- Settings Trigger Button -->
    <div id="hz-settings-trigger" onclick="togglePanel()">‚öôÔ∏è</div>

    <!-- Settings Panel -->
    <div id="hz-control-panel">
      <div class="hz-header">
        <h4>Environment Settings</h4>
        <div class="hz-close" onclick="togglePanel()">√ó</div>
      </div>

      <!-- Auto Toggle -->
      <div class="hz-auto-row">
        <span class="hz-switch-label">‚ú® Live Auto-Detect</span>
        <input type="checkbox" id="hz-auto-toggle" checked onchange="toggleAuto(this.checked)">
      </div>

      <!-- Weather Selector -->
      <div class="hz-section">
        <label class="hz-label">Weather Conditions</label>
        <select id="hz-weather-select" class="hz-select" onchange="manualUpdate()" disabled>
          <option value="clear">‚òÄÔ∏è Sunny / Clear</option>
          <option value="rain">üåßÔ∏è Rain Shower</option>
          <option value="drizzle">üå¶Ô∏è Light Drizzle</option>
          <option value="thunder">‚ö° Thunderstorm</option>
          <option value="snow">‚ùÑÔ∏è Snowfall</option>
          <option value="wind">üçÉ Windy / Storm</option>
          <option value="mist">üå´Ô∏è Fog / Mist</option>
        </select>
      </div>

      <!-- Currency & Region -->
      <div class="hz-section">
        <label class="hz-label">Currency & Region</label>
        <select id="hz-currency-select" class="hz-select" onchange="manualUpdate()" disabled>
          <option value="KES">üá∞üá™ KES (Kenya)</option>
          <option value="USD">üá∫üá∏ USD (USA/Global)</option>
          <option value="GBP">üá¨üáß GBP (UK)</option>
          <option value="EUR">üá™üá∫ EUR (Europe)</option>
        </select>
      </div>

      <!-- Language -->
      <div class="hz-section">
        <label class="hz-label">Language Preference</label>
        <select id="hz-lang-select" class="hz-select" onchange="manualUpdate()" disabled>
          <option value="en">English</option>
          <option value="sw">Swahili</option>
          <option value="fr">French</option>
          <option value="de">German</option>
        </select>
      </div>

      <div id="hz-status-bar">
        <span class="hz-status-dot"></span> <span id="hz-status-text">System Active</span>
      </div>
    </div>

    <!-- 4. Logic Script -->
    <script>
      // CONFIGURATION
      const API_KEY = "cbcace2f2fd0530b63a92e3cd2ed6fe0";
      // Bouncing Targets (React/Shopify standard classes)
      const BOUNCE_SELECTORS = "button, .btn, input[type='submit'], .card, img, .nav-link, a";

      let tsInstance;
      let thunderInterval;
      
      // --- 1. SETTINGS & PANEL LOGIC ---
      function togglePanel() {
        const panel = document.getElementById('hz-control-panel');
        panel.classList.toggle('open');
      }

      function toggleAuto(isAuto) {
        const selects = document.querySelectorAll('.hz-select');
        selects.forEach(s => s.disabled = isAuto);
        
        if(isAuto) {
          document.getElementById('hz-status-text').innerText = "Detecting Location...";
          checkEnvironment(); // Run Auto Logic
        } else {
          document.getElementById('hz-status-text').innerText = "Manual Control";
        }
      }

      function manualUpdate() {
        const weather = document.getElementById('hz-weather-select').value;
        const curr = document.getElementById('hz-currency-select').value;
        const lang = document.getElementById('hz-lang-select').value;
        
        applyTheme(weather);
        savePreferences(curr, lang);
      }

      function savePreferences(currency, lang) {
        // We save this so your React App *could* read it if programmed to
        localStorage.setItem('honeyzest_currency', currency);
        localStorage.setItem('honeyzest_lang', lang);
        console.log(`Preferences Saved: ${currency} / ${lang}`);
      }

      // --- 2. PARTICLE VISUALS ENGINE ---
      function getParticleConfig(type) {
        const config = {
          fullScreen: { enable: true, zIndex: 9997 },
          fpsLimit: 60,
          particles: { move: { enable: true } },
          interactivity: {
            detectsOn: "window",
            events: {
              onDiv: { selectors: BOUNCE_SELECTORS, enable: true, mode: "bounce", type: "rectangle" }
            }
          }
        };

        // Reset
        clearInterval(thunderInterval);
        document.getElementById('hz-layer-mist').classList.remove('active');

        switch(type) {
          case 'rain':
          case 'thunder':
            config.particles = {
              number: { value: 120 },
              color: { value: "#63a4ff" },
              shape: { type: "line" },
              opacity: { value: 0.7 },
              size: { value: { min: 1, max: 3 } },
              move: { enable: true, speed: 22, direction: "bottom", gravity: { enable: true, acceleration: 20 }, straight: true }
            };
            if(type === 'thunder') startThunder();
            break;

          case 'drizzle':
            config.particles = {
              number: { value: 60 },
              color: { value: "#a2d2ff" },
              shape: { type: "line" },
              opacity: { value: 0.5 },
              size: { value: { min: 0.1, max: 1 } },
              move: { enable: true, speed: 10, direction: "bottom", gravity: { enable: true, acceleration: 5 }, straight: true }
            };
            break;

          case 'snow':
            config.particles = {
              number: { value: 60 },
              color: { value: "#ffffff" },
              shape: { type: "circle" },
              opacity: { value: 0.9 },
              size: { value: { min: 2, max: 5 } },
              move: { enable: true, speed: 3, direction: "bottom", random: true, straight: false }
            };
            break;

          case 'wind':
            config.particles = {
              number: { value: 40 },
              color: { value: ["#5e3a07", "#2f4f2f", "#8b5a2b"] },
              shape: { type: "polygon", options: { polygon: { sides: 3 } } },
              opacity: { value: 0.8 },
              size: { value: { min: 3, max: 6 } },
              move: { enable: true, speed: 35, direction: "right", straight: false }
            };
            break;

          case 'mist':
            document.getElementById('hz-layer-mist').classList.add('active');
            config.particles = {
              number: { value: 40 },
              color: { value: "#ccc" },
              shape: { type: "circle" },
              opacity: { value: 0.1 },
              size: { value: { min: 10, max: 20 } },
              move: { enable: true, speed: 0.5, direction: "none", random: true }
            };
            break;

          default: // Clear/Sunny
            config.particles = {
              number: { value: 20 },
              color: { value: "#FFD700" },
              shape: { type: "circle" },
              opacity: { value: 0.4 },
              size: { value: { min: 1, max: 3 } },
              move: { enable: true, speed: 1, direction: "none", random: true }
            };
        }
        return config;
      }

      async function applyTheme(theme) {
        const config = getParticleConfig(theme);
        if (tsInstance) { await tsInstance.load("tsparticles", config); }
        else { tsInstance = await tsParticles.load("tsparticles", config); }
      }

      function startThunder() {
        // Random lightning flashes
        thunderInterval = setInterval(() => {
          if(Math.random() > 0.9) { // 10% chance per check
            const flash = document.getElementById('hz-layer-flash');
            flash.style.opacity = 0.8;
            setTimeout(() => { flash.style.opacity = 0; }, 150);
            setTimeout(() => { flash.style.opacity = 0.4; }, 200); // Double flash
            setTimeout(() => { flash.style.opacity = 0; }, 350);
          }
        }, 1000);
      }

      // --- 3. INTELLIGENT AUTO-DETECT ---
      function checkEnvironment() {
        if (!navigator.geolocation) return;

        navigator.geolocation.getCurrentPosition(async (pos) => {
          const { latitude: lat, longitude: lon } = pos.coords;
          
          try {
            // 1. Fetch Weather & Country Data
            const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric`);
            const data = await res.json();
            
            // 2. Set Status
            document.getElementById('hz-status-text').innerText = `${data.name}, ${data.sys.country} | ${Math.round(data.main.temp)}¬∞C`;

            // 3. Detect Weather
            const main = data.weather[0].main.toLowerCase();
            const id = data.weather[0].id;
            let weatherType = 'clear';

            if (id >= 200 && id <= 232) weatherType = 'thunder';
            else if (id >= 300 && id <= 321) weatherType = 'drizzle';
            else if (id >= 500 && id <= 531) weatherType = 'rain';
            else if (id >= 600 && id <= 622) weatherType = 'snow';
            else if (id >= 700 && id <= 781) weatherType = 'mist'; // Fog/Mist
            else if (data.wind.speed > 10) weatherType = 'wind';
            else if (main.includes('cloud')) weatherType = 'clear'; // Clouds act as clear for particles

            // Apply Weather
            document.getElementById('hz-weather-select').value = weatherType;
            applyTheme(weatherType);

            // Night Mode Logic
            const isNight = (data.dt > data.sys.sunset || data.dt < data.sys.sunrise);
            const nightLayer = document.getElementById('hz-layer-night');
            if (isNight) nightLayer.classList.add('active');
            else nightLayer.classList.remove('active');

            // 4. Detect Currency & Language based on Country Code
            const country = data.sys.country;
            let curr = 'USD';
            let lang = 'en';

            if (country === 'KE') { curr = 'KES'; lang = 'sw'; } // Kenya
            else if (['GB', 'UK'].includes(country)) { curr = 'GBP'; lang = 'en'; }
            else if (['DE', 'FR', 'IT', 'ES', 'NL'].includes(country)) { curr = 'EUR'; lang = 'en'; } // Europe (Simplified)
            
            // Update UI
            document.getElementById('hz-currency-select').value = curr;
            document.getElementById('hz-lang-select').value = lang;
            
            // Save to Storage (For React App to find later)
            savePreferences(curr, lang);

          } catch (e) { console.error(e); }
        });
      }

      // --- 4. INITIALIZATION ---
      window.onload = () => {
        // Delay to allow React to build buttons (1.5s)
        setTimeout(() => {
            // Check if user has manual override saved? If not, Auto.
            checkEnvironment(); 
        }, 1500);
      };
    </script>
    <!-- ========================================== -->
    <!-- END: HONEYZEST SMART ATMOSPHERE SYSTEM     -->
    <!-- ========================================== -->
  </body>
</html>